<!DOCTYPE html>
<html lang="fr" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bibliothèque de végétaux</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls input, .controls button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .card img {
      width: 100%;
      height: 200px;       /* hauteur fixe */
      object-fit: cover;   /* garde les proportions */
      object-position: center;
      border-bottom: 1px solid #ddd;
    }
    .card h3 {
      margin: 10px;
      font-size: 15px;
    }
    .card .actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px;
    }
    .card button {
      padding: 6px 10px;
      border: 1px solid #333;
      background: white;
      color: black;
      font-size: 13px;
      border-radius: 4px;
      cursor: pointer;
    }
    .card button:hover {
      background: #eee;
    }
    .error {
      color: red;
      text-align: center;
      margin-top: 20px;
    }
  </style>

<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:_dlc_DocId msdt:dt="string">MAD7RP7FRE63-159287787-1472837</mso:_dlc_DocId>
<mso:_dlc_DocIdItemGuid msdt:dt="string">bd9f519a-c6df-42fe-bf74-6be4371d04bb</mso:_dlc_DocIdItemGuid>
<mso:_dlc_DocIdUrl msdt:dt="string">https://groupelajus.sharepoint.com/sites/A.O/_layouts/15/DocIdRedir.aspx?ID=MAD7RP7FRE63-159287787-1472837, MAD7RP7FRE63-159287787-1472837</mso:_dlc_DocIdUrl>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>
<body>
  <h1>Bibliothèque de végétaux</h1>

  <div class="controls">
    <input type="text" id="search" placeholder="Rechercher...">
    <button onclick="loadPhotos()">Actualiser</button>
    <button onclick="resetSearch()">Réinitialiser</button>
  </div>

  <div id="grid" class="grid"></div>
  <div id="error" class="error"></div>

  <script>
    const repoUser = "All83660";
    const repoName = "bibliotheque-vegetaux";
    const branch = "main";
    const photosPath = "photos";
    const apiUrl = `https://cdn.jsdelivr.net/gh/${repoUser}/${repoName}@${branch}/${photosPath}`;

    async function loadPhotos() {
      document.getElementById("error").textContent = "";
      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      try {
        // On utilise GitHub API brute pour lister
        const res = await fetch(`https://api.github.com/repos/${repoUser}/${repoName}/contents/${photosPath}?ref=${branch}`);
        if (!res.ok) throw new Error("Impossible de charger la liste des images");
        const files = await res.json();

        files
          .filter(file => file.type === "file" && /\.(jpe?g|png|gif)$/i.test(file.name))
          .forEach(file => {
            const card = document.createElement("div");
            card.className = "card";

            card.innerHTML = `
              <img src="${file.download_url}" alt="${file.name}">
              <h3>${file.name.replace(/\.[^/.]+$/, "")}</h3>
              <div class="actions">
                <button onclick="window.open('${file.download_url}', '_blank')">Ouvrir</button>
                <button onclick="downloadImage('${file.download_url}', '${file.name}')">Télécharger</button>
              </div>
            `;

            grid.appendChild(card);
          });

      } catch (err) {
        console.error(err);
        document.getElementById("error").textContent = "Erreur: " + err.message;
      }
    }

    function resetSearch() {
      document.getElementById("search").value = "";
      Array.from(document.querySelectorAll(".card")).forEach(c => c.style.display = "");
    }

    function downloadImage(url, filename) {
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    document.getElementById("search").addEventListener("input", e => {
      const value = e.target.value.toLowerCase();
      document.querySelectorAll(".card").forEach(card => {
        const name = card.querySelector("h3").textContent.toLowerCase();
        card.style.display = name.includes(value) ? "" : "none";
      });
    });

    loadPhotos();
  </script>
</body>
</html>
